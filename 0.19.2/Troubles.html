<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Troubleshooting &mdash; SourceXtractor++ 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bibliography" href="references.html" />
    <link rel="prev" title="model_fitting" href="config_api/model_fitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SourceXtractor++
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing.html">Installing the software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using.html">Using SourceXtractor++</a></li>
<li class="toctree-l1"><a class="reference internal" href="Processing.html">Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Association.html">Asociation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="Measurements.html">Measuring</a></li>
<li class="toctree-l1"><a class="reference internal" href="TestData.html">Test Data Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigAPI.html">Configuration API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#no-sources-detected">NO SOURCES DETECTED</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-with-temporary-disk-space">Problems with temporary disk space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sourcextractor-stops-shortly-after-the-first-measurements-are-done"><strong class="program">SourceXtractor++</strong> stops shortly after the first measurements are done</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SourceXtractor++</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Troubleshooting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="troubleshooting">
<span id="index-0"></span><h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h1>
<section id="no-sources-detected">
<span id="index-1"></span><h2>NO SOURCES DETECTED<a class="headerlink" href="#no-sources-detected" title="Permalink to this heading">¶</a></h2>
<p>If you unexpectedly find <cite>NO SOURCES DETECTED</cite> on your data, you should check your weight parameters, specifically:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Weight image:</span>
<span class="go">  --weight-image arg                    Path to a fits format image to be used</span>
<span class="go">                                        as weight image.</span>
<span class="go">  --weight-type arg (=none)             Weight image type [none|background|rms|</span>
<span class="go">                                        variance|weight].</span>
<span class="go">  --weight-threshold arg                Threshold for pixels to be considered</span>
<span class="go">                                        bad pixels. In same units as weight</span>
<span class="go">                                        map.</span>
<span class="go">  --weight-absolute arg (=0)            Is the weight map provided as absolute</span>
<span class="go">                                        values or relative to background.</span>
<span class="go">  --weight-scaling arg (=1)             Weight map scaling factor.</span>
</pre></div>
</div>
<p>What can happen is that <span class="target" id="index-2"></span>inconsistent parameters are provided for <cite>–weight-image</cite>, <cite>–weight-type</cite>
and <cite>–weight-threshold</cite>. The <cite>weight-threshold</cite> is adjusted to the <cite>weight-type</cite>. This means that for the
<cite>rms</cite> and <cite>variance</cite> types one wants to mask out large values in the <cite>weight-image</cite> by providing a large <cite>weight-threshold</cite>.
but for the <cite>weight</cite> type the low values should be masked out with a small <cite>weight-threshold</cite>. Mixing this up
will result in all pixels in the detection image being masked out and no sources detected.</p>
<p>With <cite>weight-scaling</cite> one provides a scaling factor for the entire weight image. For instance <cite>–weight-scaling=0</cite>
masks out all pixels in the detection image and an inappropriate value may lower the SNR in the detection image to the point
that no sources can be found.</p>
<p>The safest way to find objetcs is indeed using <cite>–weight-type=background</cite> which determines the
noise amplitude and therefore the entire SNR for the detection directly from the detection image. With a <cite>–weight-image</cite>
and the correct <cite>–weight-type</cite> (the defaults for <cite>–weight-type</cite> are set to mask out nothing),
<cite>–weight-absolute arg=0</cite> switches on automatic scaling of the <cite>weight-image</cite> with the median rms determined from the detection
image, which usually brings the SNR for detection into a reliable range for detecting objects.</p>
</section>
<section id="problems-with-temporary-disk-space">
<span id="index-3"></span><h2>Problems with temporary disk space<a class="headerlink" href="#problems-with-temporary-disk-space" title="Permalink to this heading">¶</a></h2>
<p><strong class="program">SourceXtractor++</strong> attempts to store all intermediate products (images and so on) in memory.
If not enough memory is available or provided to <strong class="program">SourceXtractor++</strong> (with the <cite>tile-memory-limit</cite> option),
disk space is put to contribution through temporary files. Depending on the situation (data size, available disk space)
there could be no space left for these temporary files, resulting in errors such as:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2022-08-18T14:15:48CEST SourceXtractor ERROR : Failed to process the frame!</span>
<span class="go">Couldn&#39;t allocate space for new FITS file: /tmp/80122.1.euclid.test/_tmp_ml_segd1f9bb.fits status: 106</span>
</pre></div>
</div>
<p>The solution is to extend the available temporary disk space. This can be done by extending the corresponding partition
or directing the operating system to use a partition with sufficient disk space with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir $HOME/tmp</span>
<span class="go">export TMPDIR=$HOME/tmp</span>
</pre></div>
</div>
<p>Note that right now <strong class="program">SourceXtractor++</strong> does <strong>not</strong> have a parameter to directly specify the directory to store
temporary data.</p>
</section>
<section id="sourcextractor-stops-shortly-after-the-first-measurements-are-done">
<span id="index-4"></span><h2><strong class="program">SourceXtractor++</strong> stops shortly after the first measurements are done<a class="headerlink" href="#sourcextractor-stops-shortly-after-the-first-measurements-are-done" title="Permalink to this heading">¶</a></h2>
<p>It might happen that <strong class="program">SourceXtractor++</strong> stops or dumps off when the first measurements are due or when the first few measurements have been done.
The log file then ends similar to this example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2023-02-09T16:06:50CET Progress  INFO : Segmentation: 487 / 7200 (6.76%)</span>
<span class="go">2023-02-09T16:06:50CET Progress  INFO : Detected: 1200</span>
<span class="go">2023-02-09T16:06:50CET Progress  INFO : Deblended: 0</span>
<span class="go">2023-02-09T16:06:50CET Progress  INFO : Measured: 0</span>
<span class="go">2023-02-09T16:06:50CET Progress  INFO : Elapsed: 00:01:36</span>
<span class="go">2023-02-09T16:06:58CET Progress  INFO : Segmentation: 502 / 7200 (6.97%)</span>
<span class="go">2023-02-09T16:06:58CET Progress  INFO : Detected: 1234</span>
<span class="go">2023-02-09T16:06:58CET Progress  INFO : Deblended: 1</span>
<span class="go">2023-02-09T16:06:58CET Progress  INFO : Measured: 1 / 1 (100.00%)</span>
<span class="go">2023-02-09T16:06:58CET Progress  INFO : Elapsed: 00:01:43</span>
<span class="go">2023-02-09T16:07:04CET Progress  INFO : Segmentation: 502 / 7200 (6.97%)</span>
<span class="go">2023-02-09T16:07:04CET Progress  INFO : Detected: 1235</span>
<span class="go">2023-02-09T16:07:04CET Progress  INFO : Deblended: 4</span>
<span class="go">2023-02-09T16:07:04CET Progress  INFO : Measured: 4 / 4 (100.00%)</span>
<span class="go">2023-02-09T16:07:04CET Progress  INFO : Elapsed: 00:01:50</span>
<span class="go">2023-02-09T16:07:09CET Progress  INFO : Segmentation: 504 / 7200 (7.00%)</span>
<span class="go">2023-02-09T16:07:09CET Progress  INFO : Detected: 1240</span>
<span class="go">2023-02-09T16:07:09CET Progress  INFO : Deblended: 7</span>
<span class="go">2023-02-09T16:07:09CET Progress  INFO : Measured: 7 / 7 (100.00%)</span>
<span class="go">2023-02-09T16:07:09CET Progress  INFO : Elapsed: 00:01:55</span>
</pre></div>
</div>
<p>A possible cause could be a race condition created  by the concurrent calls to lower level libraries such as openMP or openBLAS.
This can happen in already multi-threaded applications such as <strong class="program">SourceXtractor++</strong>
(see <a class="reference external" href="https://github.com/xianyi/OpenBLAS/wiki/faq#multi-threaded">here</a> for details).</p>
<p>A confirmation that the dump is caused by a race condition in lower level libraries is if <strong class="program">SourceXtractor++</strong> runs with multi-threading
switched off (<cite>–thread-count=0</cite>), meaning that <strong class="program">SourceXtractor++</strong> does not dump at least beyound a couple of dozen measurements in.</p>
<p>A solution is to switch off the multi-threading of all lower level libraries by setting the following environmental variables
<em>before the call</em> to <strong class="program">SourceXtractor++</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export MKL_NUM_THREADS=1</span>
<span class="go">export NUMEXPR_NUM_THREADS=1</span>
<span class="go">export OMP_NUM_THREADS=1</span>
<span class="go">export OPENBLAS_NUM_THREADS=1</span>
<span class="go">export VECLIB_MAXIMUM_THREADS=1</span>
<span class="go">export NTHREADS=1</span>
<span class="go">sourcextractor++ --conf ...</span>
</pre></div>
</div>
<p>This switches off the multi-threading in the lower level libraries and should prevent the race conditions. In version 0.20 we
are trying to make these settings inside <strong class="program">SourceXtractor++</strong>
(see <a class="reference external" href="https://gitlab.euclid-sgs.uk/EuclidLibs/SourceXtractorPlusPlus/-/blob/develop/SEMain/src/program/SourceXtractor.cpp#L136">here</a>),
however we are not sure whether this will work in all situations and modes.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config_api/model_fitting.html" class="btn btn-neutral float-left" title="model_fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="references.html" class="btn btn-neutral float-right" title="Bibliography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019,2020,2021,2022 GenevaU/LMU/CNRS/SorbonneU.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>