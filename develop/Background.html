<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modeling the background &mdash; SourceXtractor++ 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Weighting" href="Weighting.html" />
    <link rel="prev" title="Processing" href="Processing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SourceXtractor++
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing.html">Installing the software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using.html">Using SourceXtractor++</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Processing.html">Processing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Modeling the background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background-estimation">Background estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#background-map">Background map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-and-tuning">Configuration and tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-cost">Computing cost</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Weighting.html">Weighting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Flagging.html">Flagging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Measurements.html">Measuring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigAPI.html">Configuration API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SourceXtractor++</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="Processing.html">Processing</a> &raquo;</li>
      <li>Modeling the background</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="modeling-the-background">
<span id="chap-background"></span><h1>Modeling the background<a class="headerlink" href="#modeling-the-background" title="Permalink to this heading">¶</a></h1>
<p>On linear detectors, the value measured at each pixel is the sum of a “background” signal and light coming from the sources of interest.
To be able to detect the faintest objects and make accurate measurements, <strong class="program">SourceXtractor++</strong> needs first computing a precise estimate of the background level at any position of the image: a <em>background map</em>.
Strictly speaking, there should be one background map per source, that is, what would the image look like if that very source was missing.
However, one can start by assuming that most discrete sources do not overlap too severely — which is generally the case for high galactic latitude fields —, and that the background varies smoothly across the field. <strong class="program">SourceXtractor++</strong>’s current background model is essentially the same as that of <a class="reference external" href="http://astromatic.net/software/sextractor"><strong class="program">SExtractor</strong></a> <span id="id1">[<a class="reference internal" href="references.html#id2" title="E. Bertin and S. Arnouts, 1996. SExtractor: Software for source extraction. A&amp;AS, 117:393-404.">1</a>]</span>.</p>
<section id="background-estimation">
<h2>Background estimation<a class="headerlink" href="#background-estimation" title="Permalink to this heading">¶</a></h2>
<p>To compute the background map, <strong class="program">SourceXtractor++</strong> makes a first pass through the pixel data, estimating the local background in each cell of a square grid that covers the whole frame.
The background estimator is a combination of <span class="math notranslate nohighlight">\(\kappa\,\sigma\)</span> clipping and mode estimation, similar to Stetson’s <a class="reference external" href="http://ascl.net/phpBB3/viewtopic.php?t=23410"><strong class="program">DAOPHOT</strong></a> program <span id="id2">[<a class="reference internal" href="references.html#id26" title="P. B. Stetson, 1987. DAOPHOT - A computer program for crowded-field stellar photometry. PASP, 99:191-222.">5</a>, <a class="reference internal" href="references.html#id33" title="G. S. Da Costa, 1992. Basic Photometry Techniques. In S. B. Howell, editor, Astronomical CCD Observing and Reduction Techniques, volume 23 of Astronomical Society of the Pacific Conference Series, 90. 1992.">6</a>]</span>.</p>
<p>Briefly, the local background histogram is clipped iteratively until convergence at <span class="math notranslate nohighlight">\(\pm 3\sigma\)</span> around its median. The mode of the histogram is estimated using:</p>
<div class="math notranslate nohighlight" id="equation-sexbackmode">
<span class="eqno">(1)<a class="headerlink" href="#equation-sexbackmode" title="Permalink to this equation">¶</a></span>\[\mbox{Mode} = 2.5 \times \mbox{Median} - 1.5 \times \mbox{Mean}.\]</div>
<p>Using simulated images, the expression above was found more accurate with clipped distributions :cite:1996AAS_117_393B than the usual approximation (e.g., <span id="id3">[<a class="reference internal" href="references.html#id37" title="A. Stuart and K. Ord. Kendall's Advanced Theory of Statistics: Volume 1: Distribution Theory. Number vol. 1 ;vol. 1994 in Kendall's Advanced Theory of Statistics. Wiley, 2009. ISBN 9780340614303. URL: https://books.google.fr/books?id=tW18thQWJQIC.">7</a>]</span>):</p>
<div class="math notranslate nohighlight" id="equation-ksbackmode">
<span class="eqno">(2)<a class="headerlink" href="#equation-ksbackmode" title="Permalink to this equation">¶</a></span>\[\mbox{Mode} = 3 \times \mbox{Median} - 2 \times \mbox{Mean}.\]</div>
<p><a class="reference internal" href="#fig-modevsmean"><span class="std std-numref">Fig. 3</span></a> shows that the mode estimation in <a class="reference internal" href="#equation-sexbackmode">(1)</a> is considerably less affected by source crowding than a simple clipped mean <span id="id4">[<a class="reference internal" href="references.html#id14" title="J. F. Jarvis and J. A. Tyson, 1981. FOCAS - Faint Object Classification and Analysis System. AJ, 86:476-495.">8</a>, <a class="reference internal" href="references.html#id13" title="L. Infante, 1987. A faint object processing software - Description and testing. A&amp;A, 183:177-184.">9</a>]</span> but it is <span class="math notranslate nohighlight">\(\approx 30\%\)</span> noisier.
Obviously <a class="reference internal" href="#equation-sexbackmode">(1)</a> is not valid for any distribution; <strong class="program">SourceXtractor++</strong> falls back to a simple median for estimating the local background value if the mode and the median disagree by more than 30%.</p>
<figure class="align-center" id="id5" style="width: 100%">
<span id="fig-modevsmean"></span><img alt="_images/modevsmean.svg" src="_images/modevsmean.svg" /><figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Simulations of 32×32 pixels background cells contamined by random Gaussian profiles.
The true background lies at 0 ADUs.
While being a bit noisier, the clipped “mode” gives a more robust estimate than the clipped mean in crowded regions.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="background-map">
<span id="chap-backfilter"></span><h2>Background map<a class="headerlink" href="#background-map" title="Permalink to this heading">¶</a></h2>
<p>Once the values of all background cells have been estimated, a median box filter is applied to suppress possible local overestimations due to bright stars.
Median filtering helps reducing possible ringing effects of the bicubic-spline around bright features.
The final background map is a (natural) bicubic-spline interpolation between grid cells.</p>
<p>In parallel with the making of the background map, a <em>background noise map</em>, that is, a map of the background noise standard deviation is produced.
It is used as an internal weight map when the <code class="docutils literal notranslate"><span class="pre">weight-type</span></code> configuration parameter is set to <code class="docutils literal notranslate"><span class="pre">weight-type=background</span></code>, which is the default.</p>
</section>
<section id="configuration-and-tuning">
<h2>Configuration and tuning<a class="headerlink" href="#configuration-and-tuning" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All background configuration parameters also affect background noise maps.</p>
</div>
<p>The choice of the <code class="docutils literal notranslate"><span class="pre">background-cell-size</span></code> is very important.
If it is too small, the background estimation is affected by the presence of
objects and random noise.
Most importantly, part of the flux of the most extended objects can be absorbed into the background map.
If the cell size is too large, it cannot reproduce the small scale variations of the background.
Therefore a good compromise must be found by the user.
For reasonably sampled images, cell sizes between 32 to 512 pixels are generally appropriate.</p>
<p>The user has some control over background map filtering by specifying the size of the median filter box .
The <code class="docutils literal notranslate"><span class="pre">smoothing-box-size</span></code> configuration parameter sets the box size in pixels.
<code class="docutils literal notranslate"><span class="pre">smoothing-box-size=3</span></code> is the default and is sufficient in most cases.
<code class="docutils literal notranslate"><span class="pre">smoothing-box-size=1</span></code> deactivates filtering.
Larger dimensions may occasionally be used to compensate for small background cell sizes, or in the presence of large image artifacts.</p>
<p>By default, the computed background maps are automatically subtracted from input images.
However there are situations where subtracting a <em>constant</em> from the detection image may be more relevant, e.g., for images with strongly non-Gaussian background noise <a class="reference external" href="https://en.wikipedia.org/wiki/Probability_density_function"><abbr title="Probability Density Function">pdf</abbr></a>s).
The <code class="docutils literal notranslate"><span class="pre">background-value</span></code> configuration parameter may be set to subtract a specific value from the input detection image, instead of the background map.
It is unset by default.</p>
</section>
<section id="computing-cost">
<h2>Computing cost<a class="headerlink" href="#computing-cost" title="Permalink to this heading">¶</a></h2>
<p>The background estimation operation is generally <abbr title="Input/Output">I/O</abbr>-bound, unless the image file already resides in the disk cache.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Processing.html" class="btn btn-neutral float-left" title="Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Weighting.html" class="btn btn-neutral float-right" title="Weighting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019,2020 GenevaU/LMU/CNRS/SorbonneU.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>