<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weighting &mdash; SourceXtractor++ 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Flagging" href="Flagging.html" />
    <link rel="prev" title="Modeling the background" href="Background.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SourceXtractor++
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing.html">Installing the software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using.html">Using SourceXtractor++</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Processing.html">Processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Background.html">Modeling the background</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Weighting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#effect-of-weighting">Effect of weighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weight-map-formats">Weight-map formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#detection-weight-map">Detection weight-map</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measurement-weight-map">Measurement weight-map</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Flagging.html">Flagging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Measurements.html">Measuring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigAPI.html">Configuration API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SourceXtractor++</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="Processing.html">Processing</a> &raquo;</li>
      <li>Weighting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="weighting">
<span id="chap-weighting"></span><h1>Weighting<a class="headerlink" href="#weighting" title="Permalink to this heading">¶</a></h1>
<p>The noise level in astronomical images is often fairly constant, that is, constant values for the gain, the background noise and the detection thresholds can be used over the whole frame.
Unfortunately in some cases, like strongly vignetted or composited images, this approximation is no longer good enough.
This leads to detecting clusters of detected noise peaks in the noisiest parts of the image, or missing obvious objects in the most sensitive ones.
<strong class="program">SourceXtractor++</strong> is able to handle images with variable noise.
It does it through <em>weight maps</em>, which are frames having the same size as the images where objects are detected or measured, and which describe the noise intensity at each pixel.
These maps are internally stored in units of <em>absolute variance</em> (in <span class="math notranslate nohighlight">\(ADU^2\)</span>).
We employ the generic term <em>weight map</em> because these maps can also be interpreted as quality index maps: infinite variance (<span class="math notranslate nohighlight">\(\ge 10^{30}\)</span> by definition in <strong class="program">SourceXtractor++</strong>) means that the related pixel in the science frame is totally unreliable and should be ignored.</p>
<p>The variance format was adopted as it linearizes most of the operations done over weight maps (see below).
However noise covariances between pixels are ignored.</p>
<section id="effect-of-weighting">
<h2>Effect of weighting<a class="headerlink" href="#effect-of-weighting" title="Permalink to this heading">¶</a></h2>
<p>Weight-maps modify the working of <strong class="program">SourceXtractor++</strong> in the several ways:</p>
<ul class="simple">
<li><p>The detection threshold <span class="math notranslate nohighlight">\(t\)</span> above the local sky background in the detection image is adjusted for each pixel <span class="math notranslate nohighlight">\(i\)</span> with variance <span class="math notranslate nohighlight">\(\sigma^2_i\)</span>: <span class="math notranslate nohighlight">\(t_i=\)</span><code class="docutils literal notranslate"><span class="pre">detection-threshold</span></code><span class="math notranslate nohighlight">\(\times\sqrt{\sigma^2_i}\)</span>, where <code class="docutils literal notranslate"><span class="pre">detection-threshold</span></code> is expressed in units of standard deviations of the background noise.
Pixels having a variance <em>above</em> the threshold set with the <code class="docutils literal notranslate"><span class="pre">--weight-threshold</span></code> command line option are never detected.
This may result in splitting objects crossed by a group of bad pixels.
Interpolation should be used to avoid this problem.
If convolution filtering is applied for detection then the variance map is also convolved.</p></li>
<li><p>The cleaning process takes into account the exact individual thresholds assigned to each pixel before deciding whether a faint detections must be merged with a larger one.</p></li>
<li><p>Bad pixels are discarded from the background statistics.
If more than <span class="math notranslate nohighlight">\(50\%\)</span> of the pixels in a background cell are bad, then the background and the standard deviation values are discarded and interpolated from the nearest valid cells.</p></li>
<li><p>Measurement uncertainties assume that the standard deviation of the local background noise is simply <span class="math notranslate nohighlight">\(\sqrt{\sigma^2_i}\)</span>.</p></li>
<li><p>Detection image pixels with weights beyond <code class="docutils literal notranslate"><span class="pre">weight-threshold</span></code> (above or below depending on the <code class="docutils literal notranslate"><span class="pre">--weight-type</span></code> option argument, see below) are discarded.</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Although raw <a class="reference external" href="https://en.wikipedia.org/wiki/Charge-coupled_device"><abbr>Charge-Coupled Device</abbr></a> exposures have essentially white noise, this is not the case for the resampled images that enter image stacks; resampling induces a significant amount of noise correlation between neighboring pixels.
Despite the fact that the correlation length is often smaller than the patterns to be detected or measured, and constant over the image, noise correlations bias the weight rescaling process.
It is therefore recommended to deactivate the weight-map rescaling when working with resampled image and use weight-maps with absolute values whenever possible.</p>
</div>
</section>
<section id="weight-map-formats">
<span id="weight-map-format"></span><h2>Weight-map formats<a class="headerlink" href="#weight-map-formats" title="Permalink to this heading">¶</a></h2>
<section id="detection-weight-map">
<h3>Detection weight-map<a class="headerlink" href="#detection-weight-map" title="Permalink to this heading">¶</a></h3>
<p><strong class="program">SourceXtractor++</strong> reads and converts to its internal variance format several types of weight-maps.
The detection weight-map can either be read from a FITS file specified by the <code class="docutils literal notranslate"><span class="pre">--weight-image</span></code> command line option, or computed internally.
The type of detection weight-map must be selected using the <code class="docutils literal notranslate"><span class="pre">--weight-type</span></code> command-line option.
Valid <code class="docutils literal notranslate"><span class="pre">weight_type</span></code> values are:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">background</span></code> :</dt><dd><p>The science image itself is used to compute internally a variance map (the <code class="docutils literal notranslate"><span class="pre">--weight-type</span></code> command-line option is ignored).
Robust (<span class="math notranslate nohighlight">\(3\sigma\)</span>-clipped) variance estimates are first computed within the same background cells as the <a class="reference internal" href="Background.html#chap-background"><span class="std std-ref">background model</span></a> <a class="footnote-reference brackets" href="#backfilter" id="id1">1</a>.
The resulting low-resolution variance map is then bicubic-spline-interpolated on the fly to produce the actual full-size variance map.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rms</span></code> :</dt><dd><p>The <abbr title="Flexible Image Transport System">FITS</abbr> image specified using the <code class="docutils literal notranslate"><span class="pre">--weight-image</span></code> option is a weight-map in units of standard deviations (in ADUs per pixel).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">variance</span></code> :</dt><dd><p>The <abbr title="Flexible Image Transport System">FITS</abbr> image specified using the <code class="docutils literal notranslate"><span class="pre">--weight-image</span></code> option is a weight-map in units of relative variance.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">weight</span></code> :</dt><dd><p>The <abbr title="Flexible Image Transport System">FITS</abbr> image specified using the <code class="docutils literal notranslate"><span class="pre">--weight-image</span></code> option is a weight-map in units of inverse variance.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="measurement-weight-map">
<h3>Measurement weight-map<a class="headerlink" href="#measurement-weight-map" title="Permalink to this heading">¶</a></h3>
<p>Measurement weight-maps are managed identically to detection weight-maps, except that configuration must be done through the <a class="reference internal" href="config_api/measurement_images.html#config.measurement_images.load_fits_image" title="config.measurement_images.load_fits_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_fits_image()</span></code></a> command options in the <a class="reference internal" href="Measurements.html#chap-configuration-script"><span class="std std-ref">measurement configuration script</span></a>, instead of command line options.</p>
<dl class="footnote brackets">
<dt class="label" id="backfilter"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The <a class="reference internal" href="Background.html#chap-backfilter"><span class="std std-ref">background map filtering procedure</span></a> is also applied to the variance map.</p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Background.html" class="btn btn-neutral float-left" title="Modeling the background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Flagging.html" class="btn btn-neutral float-right" title="Flagging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019,2020 GenevaU/LMU/CNRS/SorbonneU.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>